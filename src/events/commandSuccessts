import { Command, Event, EventStore, KlasaMessage } from 'klasa';

import { CommandsTable } from '../lib/typeorm/CommandsTable.entity';

export default class extends Event {
	public constructor(store: EventStore, file: string[], directory: string) {
		super(store, file, directory, {
			once: false,
			event: 'commandRun'
		});
	}

	async run(msg: KlasaMessage, cmd: Command, args: any[]) {
		CommandsTable.insert({
			userID: msg.author.id,
			channelID: msg.guild ? msg.channel.id : msg.author.id,
			guildID: msg.guild?.id,
			time: msg.createdAt,
			commandName: cmd.name,
			args
		});
	}
}
